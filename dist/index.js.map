{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/server/command.ts","webpack:///./src/server/emitter.ts","webpack:///./src/server/index.ts","webpack:///./src/server/logger.ts","webpack:///./src/server/server.ts","webpack:///./src/server/ssl.ts","webpack:///./src/server/term.ts","webpack:///./src/server/wetty.ts","webpack:///external \"compression\"","webpack:///external \"events\"","webpack:///external \"express\"","webpack:///external \"fs-extra\"","webpack:///external \"helmet\"","webpack:///external \"http\"","webpack:///external \"https\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"morgan\"","webpack:///external \"node-pty\"","webpack:///external \"os\"","webpack:///external \"path\"","webpack:///external \"serve-favicon\"","webpack:///external \"socket.io\"","webpack:///external \"url\"","webpack:///external \"winston\"","webpack:///external \"yargs\""],"names":["localhost","host","process","getuid","urlArgs","referer","def","Object","assign","url","query","getRemoteAddress","remoteAddress","split","undefined","request","headers","client","conn","user","port","auth","pass","key","command","args","loginOptions","sshOptions","address","includes","parseCommand","path","cmd","sshRemoteOptsBase","concat","match","fallback","WeTTy","Server","start","sshuser","sshhost","sshauth","sshport","sshkey","sshpass","base","sslkey","sslcert","wetty","on","code","msg","logger","info","date","debug","cert","init","opts","help","catch","err","error","exitCode","yargs","combine","timestamp","label","printf","colorize","format","createLogger","all","level","message","transports","Console","handleExceptions","stream","write","distDir","__dirname","trim","str","replace","createServer","basePath","events","emit","html","req","res","send","app","express","use","morgan","helmet","compression","favicon","next","substr","length","test","redirect","slice","get","socket","https","listen","server","http","loadSSL","ssl","files","readFile","resolve","Promise","xterm","name","cols","rows","cwd","os","homedir","env","console","log","Term","spawn","term","spawned","pid","exited","removeAllListeners","data","resize","input","kill","login","buf","reject","exec","EventEmitter","ssh","serverConf","then","sslBuffer","io","Date","sshUser","getCommand","join","username","disconnected","connection"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/server/index.ts\");\n","import * as url from 'url';\nimport { Socket } from 'socket.io';\nimport { SSH } from './interfaces';\n\nconst localhost = (host: string): boolean =>\n  process.getuid() === 0 &&\n  (host === 'localhost' || host === '0.0.0.0' || host === '127.0.0.1');\n\nconst urlArgs = (\n  referer: string,\n  def: { [s: string]: string }\n): { [s: string]: string } =>\n  Object.assign(def, url.parse(referer, true).query);\n\nconst getRemoteAddress = (remoteAddress: string): string =>\n  remoteAddress.split(':')[3] === undefined\n    ? 'localhost'\n    : remoteAddress.split(':')[3];\n\nexport default (\n  {\n    request: {\n      headers: { referer },\n    },\n    client: {\n      conn: { remoteAddress },\n    },\n  }: Socket,\n  { user, host, port, auth, pass, key }: SSH,\n  command: string\n): { args: string[]; user: boolean } => ({\n  args: localhost(host)\n    ? loginOptions(command, remoteAddress)\n    : sshOptions(\n        urlArgs(referer, {\n          host: address(referer, user, host),\n          port: `${port}`,\n          pass,\n          command,\n          auth,\n        }),\n        key\n      ),\n  user:\n    localhost(host) ||\n    user !== '' ||\n    user.includes('@') ||\n    address(referer, user, host).includes('@'),\n});\n\nfunction parseCommand(command: string, path?: string): string {\n  if (command === 'login' && path === undefined) return '';\n  return path !== undefined\n    ? `$SHELL -c \"cd ${path};${command === 'login' ? '$SHELL' : command}\"`\n    : command;\n}\n\nfunction sshOptions(\n  { pass, path, command, host, port, auth }: { [s: string]: string },\n  key?: string\n): string[] {\n  const cmd = parseCommand(command, path);\n  const sshRemoteOptsBase = [\n    'ssh',\n    host,\n    '-t',\n    '-p',\n    port,\n    '-o',\n    `PreferredAuthentications=${auth}`,\n  ];\n  if (key) {\n    return sshRemoteOptsBase.concat(['-i', key, cmd]);\n  }\n  if (pass) {\n    return ['sshpass', '-p', pass].concat(sshRemoteOptsBase, [cmd]);\n  }\n  if (cmd === '') {\n    return sshRemoteOptsBase;\n  }\n  return sshRemoteOptsBase.concat([cmd]);\n}\n\nfunction loginOptions(command: string, remoteAddress: string): string[] {\n  return command === 'login'\n    ? [command, '-h', getRemoteAddress(remoteAddress)]\n    : [command];\n}\n\nfunction address(referer: string, user: string, host: string): string {\n  const match = referer.match('.+/ssh/([^/]+)$');\n  const fallback = user ? `${user}@${host}` : host;\n  return match ? `${match[1]}@${host}` : fallback;\n}\n","import WeTTy from './wetty';\n\nexport default new WeTTy();\n","import * as yargs from 'yargs';\nimport logger from './logger';\nimport wetty from './emitter';\nimport WeTTy from './wetty';\n\nexport interface Options {\n  sshhost: string;\n  sshport: number;\n  sshuser: string;\n  sshauth: string;\n  sshkey?: string;\n  sshpass?: string;\n  sslkey?: string;\n  sslcert?: string;\n  base: string;\n  host: string;\n  port: number;\n  command?: string;\n}\n\ninterface CLI extends Options {\n  help: boolean;\n}\n\nexport default class Server {\n  public static start({\n    sshuser,\n    sshhost,\n    sshauth,\n    sshport,\n    sshkey,\n    sshpass,\n    base,\n    host,\n    port,\n    command,\n    sslkey,\n    sslcert,\n  }: Options): Promise<void> {\n    wetty\n      .on('exit', ({ code, msg }: { code: number; msg: string }) => {\n        logger.info(`Exit with code: ${code} ${msg}`);\n      })\n      .on('disconnect', () => {\n        logger.info('disconnect');\n      })\n      .on('spawn', ({ msg }) => logger.info(msg))\n      .on('connection', ({ msg, date }) => logger.info(`${date} ${msg}`))\n      .on('server', ({ msg }) => logger.info(msg))\n      .on('debug', (msg: string) => logger.debug(msg));\n    return wetty.start(\n      {\n        user: sshuser,\n        host: sshhost,\n        auth: sshauth,\n        port: sshport,\n        pass: sshpass,\n        key: sshkey,\n      },\n      { base, host, port },\n      command,\n      { key: sslkey, cert: sslcert }\n    );\n  }\n\n  public static get wetty(): WeTTy {\n    return wetty;\n  }\n\n  public static init(opts: CLI): void {\n    if (!opts.help) {\n      this.start(opts).catch(err => {\n        logger.error(err);\n        process.exitCode = 1;\n      });\n    } else {\n      yargs.showHelp();\n      process.exitCode = 0;\n    }\n  }\n}\n","import { createLogger, format, transports } from 'winston';\n\nconst { combine, timestamp, label, printf, colorize } = format;\n\nconst logger = createLogger({\n  format:\n    process.env.NODE_ENV === 'development'\n      ? combine(\n          colorize({ all: true }),\n          label({ label: 'Wetty' }),\n          timestamp(),\n          printf(\n            info =>\n              `${info.timestamp} [${info.label}] ${info.level}: ${info.message}`\n          )\n        )\n      : format.json(),\n  transports: [\n    new transports.Console({\n      level: process.env.NODE_ENV === 'development' ? 'debug' : 'info',\n      handleExceptions: true,\n    }),\n  ],\n});\n\nlogger.stream = {\n  write(message: string): void {\n    logger.info(message);\n  },\n};\n\nexport default logger;\n","import * as compression from 'compression';\nimport * as express from 'express';\nimport * as favicon from 'serve-favicon';\nimport * as helmet from 'helmet';\nimport * as http from 'http';\nimport * as https from 'https';\nimport * as path from 'path';\nimport * as socket from 'socket.io';\nimport { isUndefined } from 'lodash';\nimport * as morgan from 'morgan';\nimport logger from './logger';\nimport events from './emitter';\nimport { SSLBuffer, Server } from './interfaces';\n\nconst distDir = path.join(__dirname, 'client');\n\nconst trim = (str: string): string => str.replace(/\\/*$/, '');\n\nexport default function createServer(\n  { base, port, host }: Server,\n  { key, cert }: SSLBuffer\n): SocketIO.Server {\n  const basePath = trim(base);\n  events.emit(\n    'debug',\n    `key: ${key}, cert: ${cert}, port: ${port}, base: ${base}`\n  );\n\n  const html = (\n    req: express.Request,\n    res: express.Response\n  ): express.Response =>\n    res.send(`<!doctype html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no\">\n    <title>WeTTy - The Web Terminal Emulator</title>\n    <link rel=\"stylesheet\" href=\"${basePath}/public/index.css\" />\n  </head>\n  <body>\n    <div id=\"overlay\">\n      <div class=\"error\">\n        <div id=\"msg\"></div>\n        <input type=\"button\" onclick=\"location.reload();\" value=\"reconnect\" />\n      </div>\n    </div>\n    <div id=\"terminal\"></div>\n    <script src=\"${basePath}/public/index.js\"></script>\n  </body>\n</html>`);\n\n  const app = express();\n  app\n    .use(morgan('combined', { stream: logger.stream }))\n    .use(helmet())\n    .use(compression())\n    .use(favicon(path.join(distDir, 'favicon.ico')))\n    .use(`${basePath}/public`, express.static(distDir))\n    .use((req, res, next) => {\n      if (\n        req.url.substr(-1) === '/' &&\n        req.url.length > 1 &&\n        !/\\?[^]*\\//.test(req.url)\n      )\n        res.redirect(301, req.url.slice(0, -1));\n      else next();\n    })\n    .get(basePath, html)\n    .get(`${basePath}/ssh/:user`, html);\n\n  return socket(\n    !isUndefined(key) && !isUndefined(cert)\n      ? https.createServer({ key, cert }, app).listen(port, host, () => {\n          events.server(port, 'https');\n        })\n      : http.createServer(app).listen(port, host, () => {\n          events.server(port, 'http');\n        }),\n    { path: `${basePath}/socket.io` }\n  );\n}\n","import { readFile } from 'fs-extra';\nimport { resolve } from 'path';\nimport { isUndefined } from 'lodash';\nimport { SSL, SSLBuffer } from './interfaces';\n\nexport default async function loadSSL(ssl: SSL): Promise<SSLBuffer> {\n  if (isUndefined(ssl.key) || isUndefined(ssl.cert)) return {};\n  const files = [readFile(resolve(ssl.key)), readFile(resolve(ssl.cert))];\n  const [key, cert]: Buffer[] = await Promise.all(files);\n  return { key, cert };\n}\n","import { spawn } from 'node-pty';\nimport { isUndefined } from 'lodash';\nimport os from 'os';\nimport events from './emitter';\n\nconst xterm = {\n  name: 'xterm-256color',\n  cols: 80,\n  rows: 30,\n  cwd: os.homedir(),\n  env: process.env,\n};\n\nconsole.log(xterm)\n\nexport default class Term {\n  public static spawn(socket: SocketIO.Socket, args: string[]): void {\n    const term = spawn('/bin/bash', [], xterm);\n    const address = args[0] === 'ssh' ? args[1] : 'localhost';\n    events.spawned(term.pid, address);\n    socket.emit('login');\n    term.on('exit', code => {\n      events.exited(code, term.pid);\n      socket.emit('logout');\n      socket\n        .removeAllListeners('disconnect')\n        .removeAllListeners('resize')\n        .removeAllListeners('input');\n    });\n    term.on('data', data => {\n      socket.emit('data', data);\n    });\n    socket\n      .on('resize', ({ cols, rows }) => {\n        term.resize(cols, rows);\n      })\n      .on('input', input => {\n        if (!isUndefined(term)) term.write(input);\n      })\n      .on('disconnect', () => {\n        const { pid } = term;\n        term.kill();\n        events.exited(0, pid);\n      });\n  }\n\n  public static login(socket: SocketIO.Socket): Promise<string> {\n    const term = spawn(\n      '/usr/bin/env',\n      ['node', `${__dirname}/buffer.js`],\n      xterm\n    );\n    let buf = '';\n    return new Promise((resolve, reject) => {\n      term.on('exit', () => {\n        resolve(buf);\n      });\n      term.on('data', data => {\n        socket.emit('data', data);\n      });\n      socket\n        .on('input', (input: string) => {\n          term.write(input);\n          buf = /\\177/.exec(input) ? buf.slice(0, -1) : buf + input;\n        })\n        .on('disconnect', () => {\n          term.kill();\n          reject();\n        });\n    });\n  }\n}\n","/**\n * Create WeTTY server\n * @module WeTTy\n */\nimport * as EventEmitter from 'events';\nimport server from './server';\nimport getCommand from './command';\nimport term from './term';\nimport loadSSL from './ssl';\nimport { SSL, SSH, SSLBuffer, Server } from './interfaces';\n\nexport default class WeTTy extends EventEmitter {\n  /**\n   * Starts WeTTy Server\n   * @name start\n   */\n  public start(\n    ssh: SSH = { user: '', host: 'localhost', auth: 'password', port: 22 },\n    serverConf: Server = { base: '/wetty/', port: 3000, host: '0.0.0.0' },\n    command: string = '',\n    ssl?: SSL\n  ): Promise<void> {\n    return loadSSL(ssl).then((sslBuffer: SSLBuffer) => {\n      if (ssh.key) {\n        this.emit(\n          'warn',\n          `!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n! Password-less auth enabled using private key from ${ssh.key}.\n! This is dangerous, anything that reaches the wetty server\n! will be able to run remote operations without authentication.\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!`\n        );\n      }\n\n      const io = server(serverConf, sslBuffer);\n      /**\n       * Wetty server connected too\n       * @fires WeTTy#connnection\n       */\n      io.on('connection', (socket: SocketIO.Socket) => {\n        /**\n         * @event wetty#connection\n         * @name connection\n         */\n        this.emit('connection', {\n          msg: `Connection accepted.`,\n          date: new Date(),\n        });\n        const { args, user: sshUser } = getCommand(socket, ssh, command);\n        this.emit('debug', `sshUser: ${sshUser}, cmd: ${args.join(' ')}`);\n        if (sshUser) {\n          term.spawn(socket, args);\n        } else {\n          term\n            .login(socket)\n            .then((username: string) => {\n              this.emit('debug', `username: ${username.trim()}`);\n              args[1] = `${username.trim()}@${args[1]}`;\n              this.emit('debug', `cmd : ${args.join(' ')}`);\n              return term.spawn(socket, args);\n            })\n            .catch(() => this.disconnected());\n        }\n      });\n    });\n  }\n\n  /**\n   * terminal spawned\n   *\n   * @fires module:WeTTy#spawn\n   */\n  public spawned(pid: number, address: string): void {\n    /**\n     * Terminal process spawned\n     * @event WeTTy#spawn\n     * @name spawn\n     * @type {object}\n     */\n    this.emit('spawn', {\n      msg: `PID=${pid} STARTED on behalf of ${address}`,\n      pid,\n      address,\n    });\n  }\n\n  /**\n   * terminal exited\n   *\n   * @fires WeTTy#exit\n   */\n  public exited(code: number, pid: number): void {\n    /**\n     * Terminal process exits\n     * @event WeTTy#exit\n     * @name exit\n     */\n    this.emit('exit', { code, msg: `PID=${pid} ENDED` });\n  }\n\n  /**\n   * Disconnect from WeTTY\n   *\n   * @fires WeTTy#disconnet\n   */\n  private disconnected(): void {\n    /**\n     * @event WeTTY#disconnect\n     * @name disconnect\n     */\n    this.emit('disconnect');\n  }\n\n  /**\n   * Wetty server started\n   * @fires WeTTy#server\n   */\n  public server(port: number, connection: string): void {\n    /**\n     * @event WeTTy#server\n     * @type {object}\n     * @name server\n     */\n    this.emit('server', {\n      msg: `${connection} on port ${port}`,\n      port,\n      connection,\n    });\n  }\n}\n","module.exports = require(\"compression\");","module.exports = require(\"events\");","module.exports = require(\"express\");","module.exports = require(\"fs-extra\");","module.exports = require(\"helmet\");","module.exports = require(\"http\");","module.exports = require(\"https\");","module.exports = require(\"lodash/isUndefined\");","module.exports = require(\"morgan\");","module.exports = require(\"node-pty\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"serve-favicon\");","module.exports = require(\"socket.io\");","module.exports = require(\"url\");","module.exports = require(\"winston\");","module.exports = require(\"yargs\");"],"sourceRoot":""}